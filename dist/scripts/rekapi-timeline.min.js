!function(){define("rekapi-timeline/components/container/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text",{load:function(a){throw new Error("Dynamic load not allowed: "+a)}}),define("text!rekapi-timeline/components/container/template.mustache",[],function(){return'<div class="$details"></div>\n<div class="$timeline fill"></div>\n<div class="fill bottom-frame">\n  <div class="$controlBar"></div>\n  <div class="$scrubberDetail"></div>\n</div>\n'}),define("rekapi-timeline/constant",[],function(){"use strict";var a={PIXELS_PER_SECOND:300,NEW_KEYFRAME_PROPERTY_BUFFER_MS:500,DEFAULT_TIMELINE_SCALE:1,DEFAULT_KEYFRAME_PROPERTY_VALUE:0,DEFAULT_KEYFRAME_PROPERTY_MILLISECOND:0};return a}),define("rekapi-timeline/components/container/view",["jquery","lateralus","text!./template.mustache","../../constant"],function(a,b,c,d){"use strict";var e=b.Component.View,f=e.prototype,g=e.extend({template:c,provide:{timelineMillisecondForHandle:function(a){var b=parseInt(a.css("left"),10)-parseInt(a.parent().css("border-left-width"),10),c=b/d.PIXELS_PER_SECOND*1e3;return c/this.lateralus.model.get("timelineScale")},timelineMillisecondForXOffset:function(a){var b=a/d.PIXELS_PER_SECOND*1e3;return Math.floor(b/this.lateralus.model.get("timelineScale"))}},lateralusEvents:{"rekapi:removeKeyframePropertyTrack":function(b,c){var d=this.collectOne("currentActorModel");a(d.get("context")).css(c,"")}},initialize:function(){f.initialize.apply(this,arguments)}});return g}),define("rekapi-timeline/components/details/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/details/template.mustache",[],function(){return'<div class="$keyframePropertyDetail fill"></div>\n'}),define("rekapi-timeline/components/details/view",["lateralus","text!./template.mustache"],function(a,b){"use strict";var c=a.Component.View,d=c.prototype,e=c.extend({template:b,initialize:function(){d.initialize.apply(this,arguments)}});return e}),define("rekapi-timeline/components/keyframe-property-detail/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/keyframe-property-detail/template.mustache",[],function(){return'<h1 class="$propertyName keyframe-property-name">Detail</h1>\n<div class="add-delete-wrapper">\n  <button class="icon-button add" title="Add a new keyframe to the current track">\n    <i class="glyphicon glyphicon-plus"></i>\n  </button>\n  <button class="icon-button delete" title="Remove the currently selected keyframe">\n    <i class="glyphicon glyphicon-minus"></i>\n  </button>\n</div>\n<label class="label-input-pair row keyframe-property-millisecond">\n  <p>Millisecond:</p>\n  <input class="$propertyMillisecond property-millisecond" type="number" value="" name="millisecond" min="0">\n</label>\n<label class="label-input-pair row keyframe-property-value">\n  <p>Value:</p>\n  <input class="$propertyValue property-value" type="text" value="" name="value">\n</label>\n<label class="label-input-pair row select-container keyframe-property-easing">\n  <p>Easing:</p>\n  <select class="$propertyEasing" name="easing"></select>\n</label>\n'}),define("text!aenima/components/curve-selector/template.mustache",[],function(){return"{{#curves}}\n<option>{{.}}</option>\n{{/curves}}\n"}),define("aenima/constant",[],function(){"use strict";return{CUSTOM_CURVE_PREFIX:"customCurve",HIDABLE_VIEW_TRANSITION_DURATION:450,NEW_KEYFRAME_MS_INCREASE:1e3,NEW_KEYFRAME_X_INCREASE:200,UNDO_STACK_LIMIT:50,MODAL_OPACITY:.95,CSS_DURATION_LIMIT:3e5,INVALID_CLASS:"invalid"}}),define("aenima/components/curve-selector/view",["underscore","lateralus","shifty","text!./template.mustache","aenima/constant"],function(a,b,c,d,e){"use strict";var f=b.Component.View,g=f.prototype,h=f.extend({template:d,lateralusEvents:{tweenableCurveCreated:function(){this.render()}},initialize:function(){g.initialize.apply(this,arguments)},render:function(){var a=this.$el.val();this.renderTemplate(),this.$el.val(a)},getTemplateRenderData:function(){var b=g.getTemplateRenderData.apply(this,arguments);return a.extend(b,{curves:this.getCurveList()}),b},getCurveList:function(){var a=Object.keys(c.prototype.formula);return this.onlyShowCustomCurves?a.filter(function(a){return a.match(e.CUSTOM_CURVE_PREFIX)}):a}});return h}),define("aenima/components/curve-selector/main",["lateralus","./view","text!./template.mustache"],function(a,b,c){"use strict";var d=a.Component,e=d.extend({name:"curve-selector",View:b,template:c});return e}),define("rekapi-timeline/components/keyframe-property-detail/view",["underscore","lateralus","shifty","text!./template.mustache","aenima/components/curve-selector/main","../../constant"],function(a,b,c,d,e,f){"use strict";var g=b.Component.View,h=g.prototype,i=/-?\d*\.?\d*/g,j=g.extend({template:d,lateralusEvents:{userFocusedKeyframeProperty:function(b){this.keyframePropertyModel&&this.stopListening(this.keyframePropertyModel),this.keyframePropertyModel=b.model,this.listenTo(this.keyframePropertyModel,"change",this.render.bind(this));var d=[];a.each(c.prototype.formula,function(a,b){var c=document.createElement("option");c.innerHTML=b,d.push(c)},this),this.render()},"rekapi:removeKeyframeProperty":function(a,b){b.id===this.keyframePropertyModel.id&&(this.keyframePropertyModel=null,this.reset())},requestDeselectAllKeyframes:function(){this.$propertyName.text(this.propertyNameDefaultText),this.$propertyValue.val(""),this.$propertyMillisecond.val(""),this.$propertyEasing.val("linear")}},events:{"change .property-value":function(a){var b=this.keyframePropertyModel;if(b){this.emit("beforeUserUpdatesKeyframeValueInput");var c=$(a.target),d=c.val(),e=d.match(i)[0],f=b.get("value"),g=f.toString().replace(i,""),h=d.replace(i,"");if(!h&&g.length)return c.val(d+g),void c.change();if(""===$.trim(d)||""===$.trim(e)||g!==h)return void this.$propertyValue.val(f);var j=d==+d?+d:d;b.set(c.attr("name"),j),this.lateralus.update()}},"change .property-millisecond":function(a){var b=this.keyframePropertyModel;if(b){this.emit("beforeUserUpdatesKeyframeMillisecondInput");var c=$(a.target),d=+c.val();0>d||b.get("actor").hasKeyframeAt(d,b.get("name"))||(b.set("millisecond",d),this.lateralus.update())}},"change select":function(a){var b=this.keyframePropertyModel;if(b){this.emit("beforeUserUpdatesKeyframeCurveSelector");var c=$(a.target);b.set(c.attr("name"),c.val()),this.lateralus.update()}},"click .add":function(){if(this.keyframePropertyModel){var a=this.keyframePropertyModel.toJSON(),b=a.millisecond+f.NEW_KEYFRAME_PROPERTY_BUFFER_MS;this.emit("requestNewKeyframeProperty",{name:a.name,value:a.value,easing:a.easing,millisecond:b})}},"click .delete":function(){if(this.keyframePropertyModel){var a=this.keyframePropertyModel;a.getOwnerActor().removeKeyframeProperty(a.get("name"),a.get("millisecond"))}}},initialize:function(){h.initialize.apply(this,arguments),this.propertyNameDefaultText=this.$propertyName.text(),this.addSubview(e.View,{el:this.$propertyEasing})},render:function(){var a=document.activeElement;this.$propertyName.text(this.keyframePropertyModel.get("name")),this.$propertyMillisecond.val(this.keyframePropertyModel.get("millisecond")),this.$propertyEasing.val(this.keyframePropertyModel.get("easing")),this.$propertyValue.val(this.keyframePropertyModel.get("value")),this.lateralus.model.get("preventValueInputAutoSelect")||this.$propertyValue.select(),a===this.$propertyMillisecond[0]&&this.$propertyMillisecond.focus()},reset:function(){this.$propertyName.text(this.propertyNameDefaultText),this.$propertyMillisecond.val(""),this.$propertyValue.val("")}});return j}),define("rekapi-timeline/components/keyframe-property-detail/main",["lateralus","./model","./view","text!./template.mustache"],function(a,b,c,d){"use strict";var e=a.Component,f=e.extend({name:"keyframe-property-detail",Model:b,View:c,template:d});return f}),define("rekapi-timeline/components/details/main",["lateralus","./model","./view","text!./template.mustache","../keyframe-property-detail/main"],function(a,b,c,d,e){"use strict";var f=a.Component,g=f.extend({name:"details",Model:b,View:c,template:d,initialize:function(){this.keyframePropertyDetailComponent=this.addComponent(e,{el:this.view.$keyframePropertyDetail[0]})}});return g}),define("rekapi-timeline/components/control-bar/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/control-bar/template.mustache",[],function(){return'<button class="icon-button play">\n  <i class="glyphicon glyphicon-play"></i>\n</button>\n<button class="icon-button pause">\n  <i class="glyphicon glyphicon-pause"></i>\n</button>\n<button class="icon-button stop">\n  <i class="glyphicon glyphicon-stop"></i>\n</button>\n'}),define("rekapi-timeline/components/control-bar/view",["lateralus","text!./template.mustache"],function(a,b){"use strict";var c=a.Component.View,d=c.prototype,e=c.extend({template:b,lateralusEvents:{"rekapi:playStateChange":function(){this.lateralus.rekapi.isPlaying()?this.$el.addClass("playing"):this.$el.removeClass("playing")}},events:{"click .play":function(){this.play()},"click .pause":function(){this.pause()},"click .stop":function(){this.emit("stopAnimation")}},initialize:function(){d.initialize.apply(this,arguments),this.lateralus.isPlaying()&&this.$el.addClass("playing")},play:function(){this.lateralus.playFromCurrent()},pause:function(){this.lateralus.pause()}});return e}),define("rekapi-timeline/components/control-bar/main",["lateralus","./model","./view","text!./template.mustache"],function(a,b,c,d){"use strict";var e=a.Component,f=e.extend({name:"control-bar",Model:b,View:c,template:d});return f}),define("rekapi-timeline/components/timeline/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/timeline/template.mustache",[],function(){return'<div class="$timelineWrapper timeline-wrapper">\n  <div class="$scrubber"></div>\n  <div class="$animationTracks"></div>\n  <div class="$newTrackNameInputWrapper new-track-name-input-wrapper">\n    <button class="icon-button add" title="Add a new property to animate">\n      <i class="glyphicon glyphicon-plus"></i>\n    </button>\n    {{#supportedPropertiesAreRestricted}}\n    <select class="$newTrackName new-track-name">\n      {{#supportedProperties}}\n      <option>{{name}}</option>\n      {{/supportedProperties}}\n    </select>\n    {{/supportedPropertiesAreRestricted}}\n    {{^supportedPropertiesAreRestricted}}\n    <input class="$newTrackName new-track-name" value="newProperty"></input>\n    {{/supportedPropertiesAreRestricted}}\n  </div>\n</div>\n'}),define("rekapi-timeline/components/timeline/view",["underscore","lateralus","text!./template.mustache","../../constant"],function(a,b,c,d){"use strict";var e=b.Component.View,f=e.prototype,g=$(window),h=e.extend({template:c,events:{"click .add":function(){this.addNewKeyframePropertyFromInput()},"keyup .new-track-name":function(a){13===a.which&&this.addNewKeyframePropertyFromInput()}},lateralusEvents:{"change:timelineDuration":function(){this.updateWrapperWidth()}},provide:{timelineWrapperHeight:function(){return this.$timelineWrapper.height()-this.$newTrackNameInputWrapper.outerHeight()}},initialize:function(){f.initialize.apply(this,arguments),this.updateWrapperWidth(),this.windowHandler=this.onWindowResize.bind(this),g.on("resize",this.windowHandler)},getTemplateRenderData:function(){var b=f.getTemplateRenderData.apply(this,arguments);return a.extend(b,{supportedPropertiesAreRestricted:!!this.lateralus.model.get("supportedProperties").length}),b},dispose:function(){g.off("resize",this.windowHandler),f.dispose.apply(this,arguments)},onWindowResize:function(){this.updateWrapperWidth()},getPixelWidthForTracks:function(){var a=this.lateralus.model.get("timelineDuration"),b=a/1e3;return d.PIXELS_PER_SECOND*b+this.$el.width()},updateWrapperWidth:function(){this.$timelineWrapper.css("width",this.getPixelWidthForTracks())},addNewKeyframePropertyFromInput:function(){var b=this.$newTrackName.val(),c=this.collectOne("currentActorModel"),e={},f=this.lateralus.model.get("supportedProperties"),g=f.length?a.findWhere(f,{name:b}).defaultValue:d.DEFAULT_KEYFRAME_PROPERTY_VALUE;e[b]=g,c.keyframe(d.DEFAULT_KEYFRAME_PROPERTY_MILLISECOND,e)}});return h}),define("rekapi-timeline/components/scrubber/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/scrubber/template.mustache",[],function(){return'<div class="$scrubberWrapper scrubber-wrapper">\n  <div class="$scrubberHandle scrubber-handle">\n    <i class="glyphicon glyphicon-chevron-down scrubber-icon">&nbsp;</i>\n    <figure class="$scrubberGuide scrubber-guide"></figure>\n  </div>\n</div>\n'}),define("rekapi-timeline/components/scrubber/view",["underscore","lateralus","text!./template.mustache","../../constant"],function(a,b,c,d){"use strict";var e=b.Component.View,f=e.prototype,g=e.extend({template:c,lateralusEvents:{"change:timelineScale":function(){this.render(),this.syncContainerToTimelineLength()},"change:timelineDuration":function(){this.render()},requestResizeScrubberGuide:function(){this.resizeScrubberGuide()},"rekapi:afterUpdate":function(){this.render()},"rekapi:addKeyframePropertyTrack":function(){a.defer(this.resizeScrubberGuide.bind(this))},"rekapi:removeKeyframePropertyTrack":function(){a.defer(this.resizeScrubberGuide.bind(this))},"rekapi:timelineModified":function(){this.syncContainerToTimelineLength()}},events:{"drag .scrubber-handle":function(){var a=this.collectOne("timelineMillisecondForHandle",this.$scrubberHandle);this.lateralus.update(a)},"click .scrubber-wrapper":function(a){if(a.target===this.$scrubberWrapper[0]){var b=this.collectOne("timelineMillisecondForXOffset",a.offsetX),c=this.lateralus;c.pause(),c.update(b,!0)}}},initialize:function(){f.initialize.apply(this,arguments),this.syncContainerToTimelineLength(),this.$scrubberHandle.dragon({within:this.$scrubberWrapper})},deferredInitialize:function(){this.resizeScrubberGuide()},render:function(){this.syncHandleToTimelineLength()},syncContainerToTimelineLength:function(){var a=this.lateralus.model.get("timelineDuration")*(d.PIXELS_PER_SECOND/1e3)*this.lateralus.model.get("timelineScale");this.$scrubberWrapper.width(a+this.$scrubberHandle.width())},syncHandleToTimelineLength:function(){var a=this.lateralus.getLastPositionUpdated()*this.lateralus.model.get("timelineDuration"),b=a*(d.PIXELS_PER_SECOND/1e3)*this.lateralus.model.get("timelineScale");this.$scrubberHandle.css("left",b)},resizeScrubberGuide:function(){var a=this.collectOne("timelineWrapperHeight"),b=parseInt(this.$scrubberWrapper.css("borderBottomWidth"),10);this.$scrubberGuide.css("height",a-this.$el.height()+b)}});return g}),define("rekapi-timeline/components/scrubber/main",["lateralus","./model","./view","text!./template.mustache"],function(a,b,c,d){"use strict";var e=a.Component,f=e.extend({name:"scrubber",Model:b,View:c,template:d});return f}),define("rekapi-timeline/components/animation-tracks/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/animation-tracks/template.mustache",[],function(){return""}),define("rekapi-timeline/components/actor-tracks/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/actor-tracks/template.mustache",[],function(){return""}),define("rekapi-timeline/components/keyframe-property-track/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({defaults:{trackName:""},initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/keyframe-property-track/template.mustache",[],function(){return""}),define("text!rekapi-timeline/components/keyframe-property/template.mustache",[],function(){return'<div class="$handle keyframe-property" data-name="{{keyframeProperty.name}}" >&nbsp;</div>\n'}),define("rekapi-timeline/components/keyframe-property/view",["lateralus","text!./template.mustache","../../constant"],function(a,b,c){"use strict";var d=a.Component.View,e=d.prototype,f=d.extend({template:b,events:{mousedown:function(){this.activate()},drag:function(){this.updateKeyframeProperty()},dragEnd:function(){this.overwriteRedundantProperty(),this.emit("keyframePropertyDragEnd")},dragStart:function(){this.emit("keyframePropertyDragStart")}},modelEvents:{change:function(){this.render()},destroy:function(){this.dispose()},"change:isActive":function(a,b){this.isActivating=b,b&&this.emit("userFocusedKeyframeProperty",this),this.setActiveClass(b),this.isActivating=!1}},lateralusEvents:{"rekapi:removeKeyframeProperty":function(a,b){var c=this.model.get("nextProperty");c&&c.id===b.id&&this.activate()},"change:timelineScale":function(){this.render()},userFocusedKeyframeProperty:function(){this.isActivating||this.model.set("isActive",!1)},activateKeyframePropertyByNameAndMillisecond:function(a){var b=this.model.toJSON();a.name===b.name&&a.millisecond===b.millisecond&&this.activate()}},provide:{activeKeyframeProperties:function(){return this.model.get("isActive")?this:void 0}},initialize:function(){e.initialize.apply(this,arguments),this.$el.css("visibility","hidden")},deferredInitialize:function(){this.$el.dragon({within:this.$el.parent()}),this.doImmediatelyFocus&&this.activate(),this.render(),this.$el.css("visibility","")},render:function(){var a=this.$el.data("dragon");if(!a||!a.isDragging){var b=c.PIXELS_PER_SECOND*this.model.get("millisecond")/1e3*this.lateralus.model.get("timelineScale");this.$el.css({left:b})}},activate:function(){this.model.set("isActive",!0)},setActiveClass:function(a){this.$el[a?"addClass":"removeClass"]("active")},updateKeyframeProperty:function(){var a=this.model,b=Math.round(this.collectOne("timelineMillisecondForHandle",this.$el));b===a.get("millisecond")||this.doesPropertyAlreadyExistAt(b)||(a.set("millisecond",b),this.lateralus.update())},overwriteRedundantProperty:function(){var a=this.model,b=Math.round(this.collectOne("timelineMillisecondForHandle",this.$el));if(this.emit("beginTemporaryTimelineModifications"),a.set("millisecond",1e99),this.doesPropertyAlreadyExistAt(b)){var c=a.get("actor");c.removeKeyframeProperty(a.get("name"),b)}a.set("millisecond",b),this.emit("endTemporaryTimelineModifications"),this.lateralus.update()},doesPropertyAlreadyExistAt:function(a){return this.model.get("actor").hasKeyframeAt(a,this.model.get("name"))}});return f}),define("rekapi-timeline/components/keyframe-property/main",["lateralus","./view","text!./template.mustache"],function(a,b,c){"use strict";var d=a.Component,e=d.extend({name:"keyframe-property",View:b,template:c});return e}),define("rekapi-timeline/components/keyframe-property-track/view",["underscore","lateralus","text!./template.mustache","../keyframe-property/main"],function(a,b,c,d){"use strict";var e=b.Component.View,f=e.prototype,g=e.extend({template:c,lateralusEvents:{keyframePropertyAdded:function(a){a.get("name")===this.model.get("trackName")&&this.addKeyframePropertyComponent(a,!0)},userFocusedKeyframeProperty:function(b){this.setActiveClass(a.contains(this.component.components,b.component))}},events:{dblclick:function(a){if(a.target===this.el){var b=this.collectOne("timelineMillisecondForXOffset",a.offsetX);this.addNewKeyframeAtMillisecond(b)}}},initialize:function(){f.initialize.apply(this,arguments);var a=this.model.get("trackName");this.$el.attr("data-track-name",a),this.actorModel.keyframePropertyCollection.where({name:a}).forEach(function(a){this.addKeyframePropertyComponent(a,!1)}.bind(this))},addKeyframePropertyComponent:function(a,b){var c=this.addComponent(d,{model:a,doImmediatelyFocus:!!b});this.$el.append(c.view.$el)},setActiveClass:function(a){this.$el[a?"addClass":"removeClass"]("active")},addNewKeyframeAtMillisecond:function(b){var c=a.chain(this.component.components).filter(function(a){return"keyframe-property"===a.toString()}).sortBy(function(a){return a.view.model.get("millisecond")}).value(),d=c[0],e=1,f=c.length;for(e;f>e&&!(c[e].view.model.get("millisecond")>b);e++)d=c[e];var g=d.view.model.toJSON();this.emit("requestNewKeyframeProperty",{name:g.name,value:g.value,easing:g.easing,millisecond:b})}});return g}),define("rekapi-timeline/components/keyframe-property-track/main",["lateralus","./model","./view","text!./template.mustache"],function(a,b,c,d){"use strict";var e=a.Component,f=e.extend({name:"keyframe-property-track",Model:b,View:c,template:d,lateralusEvents:{"rekapi:removeKeyframePropertyTrack":function(a,b){b===this.model.get("trackName")&&this.dispose()}}});return f}),define("rekapi-timeline/components/actor-tracks/view",["lateralus","text!./template.mustache","../keyframe-property-track/main"],function(a,b,c){"use strict";var d=a.Component.View,e=d.prototype,f=d.extend({template:b,modelEvents:{keyframePropertyTrackAdded:function(a){this.addKeyframePropertyTrackComponent(a)},beforeDispose:function(){this.component.dispose()}},initialize:function(){e.initialize.apply(this,arguments),this.keyframePropertyTrackComponents=[],this.model.getTrackNames().forEach(this.addKeyframePropertyTrackComponent,this)},addKeyframePropertyTrackComponent:function(a){var b=this.addComponent(c,{actorModel:this.model},{modelAttributes:{trackName:a}});this.keyframePropertyTrackComponents.push(b),this.$el.append(b.view.$el)}});return f}),define("rekapi-timeline/components/actor-tracks/main",["lateralus","./model","./view","text!./template.mustache"],function(a,b,c,d){"use strict";var e=a.Component,f=e.extend({name:"actor-tracks",Model:b,View:c,template:d});return f}),define("rekapi-timeline/components/animation-tracks/view",["underscore","lateralus","text!./template.mustache","../actor-tracks/main"],function(a,b,c,d){"use strict";var e=b.Component.View,f=e.prototype,g=e.extend({template:c,lateralusEvents:{actorAdded:function(a){this.addActorComponent(a)}},initialize:function(){f.initialize.apply(this,arguments),this.actorTracksComponents=[],this.collectOne("actorCollection").each(this.addActorComponent,this)},addActorComponent:function(a){var b=this.addComponent(d,{model:a});this.actorTracksComponents.push(b),this.$el.append(b.view.$el)}});return g}),define("rekapi-timeline/components/animation-tracks/main",["lateralus","./model","./view","text!./template.mustache"],function(a,b,c,d){"use strict";var e=a.Component,f=e.extend({name:"animation-tracks",Model:b,View:c,template:d});return f}),define("rekapi-timeline/components/timeline/main",["lateralus","./model","./view","text!./template.mustache","../scrubber/main","../animation-tracks/main"],function(a,b,c,d,e,f){"use strict";var g=a.Component,h=g.extend({name:"timeline",Model:b,View:c,template:d,initialize:function(){this.scrubberComponent=this.addComponent(e,{el:this.view.$scrubber[0]}),this.animationTracksComponent=this.addComponent(f,{el:this.view.$animationTracks[0]})}});return h}),define("rekapi-timeline/components/scrubber-detail/model",["lateralus"],function(a){"use strict";var b=a.Component.Model,c=b.prototype,d=b.extend({initialize:function(){c.initialize.apply(this,arguments)}});return d}),define("text!rekapi-timeline/components/scrubber-detail/template.mustache",[],function(){return'<label class="label-input-pair row scrubber-scale">\n  <p>Timeline zoom:</p>\n  <input type="number" class="$scrubberScale" value="{{initialZoom}}" min="0" step="10">\n</label>\n<p class="position-monitor">\n  <span class="$currentPosition"></span>ms / <span class="$animationLength"></span>ms\n</p>\n'}),define("rekapi-timeline/components/scrubber-detail/view",["underscore","lateralus","text!./template.mustache"],function(a,b,c){"use strict";var d=b.Component.View,e=d.prototype,f=d.extend({template:c,lateralusEvents:{"change:timelineDuration":function(){this.renderAnimationLength()},"rekapi:afterUpdate":function(){this.renderCurrentPosition()}},events:{"change .scrubber-scale input":function(){this.$scrubberScale[0].validity.valid&&this.lateralus.model.set("timelineScale",this.$scrubberScale.val()/100)}},initialize:function(){e.initialize.apply(this,arguments),this.renderAnimationLength()},getTemplateRenderData:function(){var b=e.getTemplateRenderData.apply(this,arguments);return a.extend(b,{initialZoom:100*this.lateralus.model.get("timelineScale")}),b},renderAnimationLength:function(){this.$animationLength.text(this.lateralus.model.get("timelineDuration"))},renderCurrentPosition:function(){var a=this.lateralus,b=a.getLastPositionUpdated()*a.model.get("timelineDuration");this.$currentPosition.text(Math.floor(b)||0)}});return f}),define("rekapi-timeline/components/scrubber-detail/main",["lateralus","./model","./view","text!./template.mustache"],function(a,b,c,d){"use strict";var e=a.Component,f=e.extend({name:"scrubber-detail",Model:b,View:c,template:d});return f}),define("rekapi-timeline/components/container/main",["lateralus","./model","./view","text!./template.mustache","../details/main","../control-bar/main","../timeline/main","../scrubber-detail/main"],function(a,b,c,d,e,f,g,h){"use strict";var i=a.Component,j=i.extend({name:"rekapi-timeline-container",Model:b,View:c,template:d,initialize:function(){this.detailsComponent=this.addComponent(e,{el:this.view.$details[0]}),this.controlBar=this.addComponent(f,{el:this.view.$controlBar[0]}),this.timelineComponent=this.addComponent(g,{el:this.view.$timeline[0]}),this.scrubberDetailComponent=this.addComponent(h,{el:this.view.$scrubberDetail[0]})}});return j}),define("rekapi-timeline/utils",["underscore"],function(a){"use strict";return{proxy:function(b,c,d){d=d||{};var e=d.blacklistedMethodNames||[],f=d.subject,g=a.difference(Object.keys(b.prototype),e),h=b.prototype,i=c.prototype;g.forEach(function(a){var b=h[a];i[a]=function(){var a=f?f.call(this):this;return b.apply(a,arguments)}},this)}}}),define("rekapi-timeline/model",["underscore","lateralus","./constant"],function(a,b,c){"use strict";var d=b.Model.extend({defaults:{timelineScale:c.DEFAULT_TIMELINE_SCALE,timelineDuration:0,supportedProperties:[],preventValueInputAutoSelect:!1}});return d}),define("rekapi-timeline/models/keyframe-property",["underscore","backbone","lateralus","rekapi","../utils"],function(a,b,c,d,e){"use strict";var f=c.Component.Model,g=f.extend({defaults:{keyframeProperty:d.KeyframeProperty,isActive:!1},lateralusEvents:{"rekapi:removeKeyframeProperty":function(a,b){b.id===this.id&&this.destroy()}},initialize:function(){this.attributes=this.attributes.keyframeProperty,a.defaults(this.attributes,a.omit(g.prototype.defaults,"keyframeProperty")),this.id=this.attributes.id},set:function(a,c){if("string"==typeof a){var d=this.get(a);if(a in this.attributes){if(this.get(a)===c)return;var e={};e[a]=c,this.attributes.actor.modifyKeyframeProperty(this.attributes.name,this.attributes.millisecond,e)}this.attributes[a]=d}b.Model.prototype.set.apply(this,arguments)},getOwnerActor:function(){return this.collection.actorModel},destroy:function(){this.trigger("destroy")}});return e.proxy(d.KeyframeProperty,g,{subject:function(){return this.attributes}}),g}),define("rekapi-timeline/collections/keyframe-property",["backbone","lateralus","../models/keyframe-property"],function(a,b,c){"use strict";var d=b.Component.Collection,e=d.extend({model:c,lateralusEvents:{"rekapi:addKeyframeProperty":function(a,b){b.actor.id===this.actorModel.id&&this.addKeyframeProperty(b)},"rekapi:removeKeyframeProperty":function(a,b){b.actor.id===this.actorModel.id&&this.removeKeyframeProperty(b)}},initialize:function(a,b){this.actorModel=b.actorModel},addKeyframeProperty:function(a){var b=this.initModel(c,{keyframeProperty:a});this.emit("keyframePropertyAdded",this.add(b))},removeKeyframeProperty:function(a){this.remove(a.id)}});return e}),define("rekapi-timeline/models/actor",["lateralus","rekapi","../collections/keyframe-property","../utils"],function(a,b,c,d){"use strict";var e=a.Component.Model,f=e.extend({defaults:{actor:b.Actor},provide:{currentActorModel:function(){return this}},lateralusEvents:{requestNewKeyframeProperty:function(a){var b={};b[a.name]=a.value,this.keyframe(a.millisecond,b,a.easing)},"rekapi:addKeyframePropertyTrack":function(a,b){b.actor.id===this.id&&this.addKeyframePropertyTrack(b.name)},"rekapi:removeActor":function(a,b){b.id===this.id&&this.dispose()}},initialize:function(){this.attributes=this.attributes.actor,this.id=this.attributes.id,this.getTrackNames().forEach(this.addKeyframePropertyTrack,this);var a=this.initCollection(c,null,{actorModel:this});this.keyframePropertyCollection=a,this.getTrackNames().forEach(function(b){this.getPropertiesInTrack(b).forEach(a.addKeyframeProperty,a)},this)},addKeyframePropertyTrack:function(a){this.emit("keyframePropertyTrackAdded",a)}});return d.proxy(b.Actor,f,{subject:function(){return this.attributes}}),f}),define("rekapi-timeline/collections/actor",["underscore","backbone","lateralus","../models/actor"],function(a,b,c,d){"use strict";var e=c.Component.Collection,f=e.extend({model:d,provide:{actorCollection:function(){return this}},lateralusEvents:{"rekapi:addActor":function(a,b){this.addActor(b)}},initialize:function(){a.each(this.lateralus.getAllActors(),this.addActor,this)},addActor:function(a){var b=this.initModel(d,{actor:a});this.emit("actorAdded",this.add(b))}});return f}),define("rekapi-timeline/rekapi-timeline",["underscore","lateralus","rekapi","./components/container/main","./utils","./model","./collections/actor","jquery-dragon"],function(a,b,c,d,e,f,g){"use strict";var h=b.beget(function(c,e,f){b.apply(this,arguments),this.rekapi=e,this.model.set(f),this.model.set("timelineDuration",this.getAnimationLength()),this.globalRenderData=this.model.pick("supportedProperties"),this.getEventNames().forEach(function(b){this.rekapi.on(b,function(){this.emit.apply(this,["rekapi:"+b].concat(a.toArray(arguments)))}.bind(this))}.bind(this)),this.actorCollection=this.initCollection(g),this.containerComponent=this.addComponent(d,{el:c})},{Model:f});return a.extend(h.prototype,{lateralusEvents:{stopAnimation:function(){this.stop().update(0)},"rekapi:removeKeyframePropertyComplete":function(){if(!this.isPlaying()){var a=this.model.get("timelineDuration"),b=this.getLastMillisecondUpdated(),c=b>a?a:void 0;this.update(c)}},"rekapi:timelineModified":function(){if(!this.isPlaying()){var a=this.model.get("timelineDuration");this.getLastMillisecondUpdated()>a&&this.update(a)}this.model.set("timelineDuration",this.getAnimationLength())}},update:function(){var a=this.rekapi;try{a.update.apply(a,arguments)}catch(b){"TypeError"===b.name?this.warn("Keyframe property format mismatch detected"):this.warn(b)}return this.rekapi},getLastMillisecondUpdated:function(){return this.getLastPositionUpdated()*this.model.get("timelineDuration")}}),c.prototype.createTimeline=function(a,b){return new h(a,this,b||{})},e.proxy(c,h,{blacklistedMethodNames:["on","off","trigger","update"],subject:function(){return this.rekapi}}),h}),define("rekapi-timeline",["rekapi-timeline/rekapi-timeline"],function(a){return a})}();